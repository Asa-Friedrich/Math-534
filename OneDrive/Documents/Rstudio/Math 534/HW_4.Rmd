---
title: "Math 534 - HW 4"
author: "Asa Friedrich"
date: "2025-09-29"
output:
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



Asa Friedrich

9/28/2025

Q 1. How many rows are available in the Measurements table of the Smith College Wideband Auditory Immittance database?

```{r}
library(tidyverse)
library(mdsr)
library(RMariaDB)
library(tibble)
library(knitr)

con <- dbConnect(
  MariaDB(), host = "scidb.smith.edu",
  user = "waiuser", password = "smith_waiDB", 
  dbname = "wai"
)
Measurements <- tbl(con, "Measurements")

Measurements %>% 
  summarise(n_rows = n())
```



Q 2. Identify what years of data are available in the flights table of the airlines database.

```{r}

options(scipen = 999)

con <- dbConnect_scidb("airlines")

dbListTables(con)

dbListFields(con, "flights")

dbGetQuery(con, "
  SELECT MIN(year) AS start_year,
         MAX(year) AS end_year
  FROM flights
")
```


Q 3.How many domestic flights flew into Dallas-Fort Worth (DFW) on May 14, 2015?

```{r}
dbGetQuery(con, "
           SELECT COUNT(*) AS num_flights
           FROM flights
           WHERE dest = 'DFW'
           AND year = 2015
           AND month = 5
           AND day = 14
           ")
```



Of all the destinations from Chicago Oâ€™Hare (ORD), which were the most common in 2015?

```{r}
# It was truncating the table so I couldn't read the airport codes
dest_list <- dbGetQuery(con, "
           SELECT dest, COUNT(*) AS num_flights
           FROM flights
           WHERE origin = 'ORD'
              AND year = 2015
           GROUP BY dest
           ORDER BY num_flights DESC
           LIMIT 10
           ")

# It was truncating the table so I couldn't read the airport codes

knitr::kable(dest_list, format = "markdown")

```


Which airport had the highest average arrival delay time in 2015?


```{r}
delay_list <- dbGetQuery(con,"
                         SELECT dest, AVG(arr_delay) AS avg_arrival_delay
                         FROM flights
                         WHERE year = 2015
                         GROUP BY dest
                         ORDER BY avg_arrival_delay DESC
                         LIMIT 1
                         ")

knitr::kable(delay_list, format = "markdown")

```


How many domestic flights came into or flew out of Bradley Airport (BDL) in 2015?

```{r}
BDL_list <- dbGetQuery(con, "
                      SELECT COUNT(*) AS flights_BDL
                      FROM flights
                      WHERE year = 2015
                      and (origin = 'BDL' or dest = 'BDL')
                       ")

knitr::kable(BDL_list, format = "markdown")
```

List the airline and flight number for all flights between LAX and JFK on September 26th, 2015.

```{r}
flights_list <- dbGetQuery(con, "
                           SELECT carrier, flight, year, month, day, origin, dest
                           FROM flights
                           WHERE year = 2015 
                              AND month = 9
                              AND day = 26
                              AND ((origin = 'LAX' and dest = 'JFK')
                                OR (origin = 'JFK' and dest = 'LAX'))
                           ")

#Need outer parentheses around the or statement

knitr::kable(flights_list, format = "markdown")
```



Q 4. Wideband acoustic immittance (WAI) is an area of biomedical research that strives to develop WAI measurements as noninvasive auditory diagnostic tools. WAI measurements are reported in many related formats, including absorbance, admittance, impedance, power reflectance, and pressure reflectance. More information can be found about this public facing WAI database at http://www.science.smith.edu/wai-database/home/about.

```{r}
library(RMariaDB)
db <- dbConnect(
  MariaDB(), 
  user = "waiuser", 
  password = "smith_waiDB", 
  host = "scidb.smith.edu", 
  dbname = "wai"
)


dbListTables(db)

dbListFields(db, "Subjects")
dbListFields(db, "Codebook")

dbListFields(db, "Measurements")
```



a. How many female subjects are there in total across all studies?


```{r}
dbGetQuery(db, "
  SELECT Sex, COUNT(*) AS count
  FROM Subjects
  GROUP BY Sex;
")


dbGetQuery(db, "
           SELECT COUNT(*) as total_female
           FROM Subjects
           WHERE Sex = 'Female';
           ")

```


b. Find the average absorbance for participants for each study, ordered by highest to lowest value.

```{r}
dbGetQuery(db, "
           SELECT Session, AVG(Absorbance) as avg_absorb
           FROM Measurements
           Group BY Session
           ORDER by avg_absorb DESC;
           ")

```


c. Write a query to count all the measurements with a calculated absorbance of less than 0.


```{r}
dbGetQuery(db, "
           SELECT COUNT(*) AS Number_of_negative_absorbance
           FROM Measurements
           WHERE Absorbance < 0
           ")
```


The following open-ended question may require more than one query and a thoughtful response. Based on data from 2013 only, and assuming that transportation to the airport is not an issue, would you rather fly out of JFK, LaGuardia (LGA), or Newark (EWR)? Why or why not? Use the dbConnect_scidb function to connect to the airlines database.


```{r}
dbListTables(con)

dbListFields(con, "flights")
dbListFields(con, "airports")

dbGetQuery(con, "
           SELECT origin, AVG(dep_delay) AS avg_departure_delay
                         FROM flights
                         WHERE year = 2013
                         AND ((origin = 'JFK') 
                               OR (origin = 'LGA') 
                               OR (origin = 'EWR'))
                         GROUP BY origin
                         ORDER BY avg_departure_delay DESC")

dbGetQuery(con, "
           SELECT origin, AVG(arr_delay) AS avg_arrival_delay
                         FROM flights
                         WHERE year = 2013
                         AND ((origin = 'JFK') 
                               OR (origin = 'LGA') 
                               OR (origin = 'EWR'))
                         GROUP BY origin
                         ORDER BY avg_arrival_delay DESC")

dbGetQuery(con, "
           SELECT origin, COUNT(*) AS cancelled
                         FROM flights
                         WHERE year = 2013
                         AND ((origin = 'JFK') 
                               OR (origin = 'LGA') 
                               OR (origin = 'EWR'))
                         GROUP BY origin
                         DESC")

dbGetQuery(con, "
           SELECT origin, COUNT(*) AS diverted
                         FROM flights
                         WHERE year = 2013
                         AND ((origin = 'JFK') 
                               OR (origin = 'LGA') 
                               OR (origin = 'EWR'))
                         GROUP BY origin
                         DESC")
                         
```


                         

I would rather fly out of Laguardia because while the departure and arrival delays are very similar to that of JFK far less flights which are scheduled to leave Laguardia are cancelled or diverted. So based on this data you have the best outcomes for flights on average when leaving from Laguardia for your trip.



